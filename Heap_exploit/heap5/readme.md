# NULL BYTE

```
security check:
```
![image](https://user-images.githubusercontent.com/93699926/227141929-eeb94e8b-8799-4e94-ab91-4ff3d305d010.png)
```
Let check the binary pseudocode code in ida
``` 
![image](https://user-images.githubusercontent.com/93699926/227142357-5cccf209-535f-4855-9b11-1b0cfa94cbb6.png)
``` 
Like before challenge ,we has 4 main function create,show ,edit and delete
Let check delete function
```
![image](https://user-images.githubusercontent.com/93699926/227142808-5373896d-5cdf-457c-870c-6de9eb6afe91.png)
``` 
No uaf or double free cause the pointer to heap is set NULL after free
all security mode is on and we has no address leak
let check out edit()
```
![image](https://user-images.githubusercontent.com/93699926/227143496-6ef1b578-e56d-40b1-8ea2-754f76f9ffdb.png)

``` 
So in edit it will prompt us for index and check (if Store[index])
It free that chunk and ask for a new size that we want
We wil use this function to overflow others chunk
```
``` 
PLAN:
We will use edit to over other chunk metadata section 
using null byte poison technic to create a overlapping  bug
leak address of libc 
let prepare chunks for our plan
```
![image](https://user-images.githubusercontent.com/93699926/227145107-a0e89774-da8f-4579-91bd-f57b4c074190.png)
```
next we will free chunk 1 
and use edit to the metadata of chunk1(first is 0x210) to 0x200
```
![image](https://user-images.githubusercontent.com/93699926/227146388-91c8b49b-4667-4012-8333-5a91835af9a5.png)

``` 
let check out the heap after this

```
![image](https://user-images.githubusercontent.com/93699926/227148723-ddf459d3-eb13-4a03-acd1-4a9aeb7a9b0e.png)

![image](https://user-images.githubusercontent.com/93699926/227147107-a334c080-0e30-436f-898e-04ac4afb3481.png)
``` 
we has sucessfully change the size of chunk 1 from 0x210 to 0x200
Note that the prev size field of chunk2 is 0x210 
now we will create 2 chunk size 0x100 and malloc will split chunk 1 in half and give us respectively
```
![image](https://user-images.githubusercontent.com/93699926/227149313-054e7e33-1b3a-4257-a8c6-f4074a894899.png)

![image](https://user-images.githubusercontent.com/93699926/227149999-7f5838b5-1e2e-40d6-8184-c60118561b27.png)
```
we see that after we create 2 chunk of size 0x100 malloc has been try to update the metadata of chunk2 which should be 0x210 and 0x91 reference that the chunk 
before chunk 2 which is chunk1b is in use 
and it has updated that one bit 16byte before it should be (look at the upper part of chunk2)
So now if we free chunk1a and then chunk2 malloc will confuse that chunk1b is not in use and it will consolidate chunk 2 with chunk1a which has chunk1b in the middle
But actually our chunk1b is still in use and we get the control of it 
```
![image](https://user-images.githubusercontent.com/93699926/227151965-b74b9eb9-a6c9-4ac1-b92e-91eea21766e8.png)
```
To confirm this let check the heap bin out
we see that chunk2 and chunk get consolidate together and we has a chunk of 0x210+0x90
but beetwen that is chunk1b which we still got control over 
```

![image](https://user-images.githubusercontent.com/93699926/227169013-15ef1859-edbb-4b32-8d70-fde2aac87c7d.png)
``` 
now we create a chunk size of chunk1a and the remainder in the unsorted bin will be drop by 0x100 
so now if you check to see in the unsorted bin it the remainder chunk in it will has the foward pointer chunk1b which w still got controll of
now to leak the libc address all we need is print out the content of store[index=4] which is our chunk1b
```
# Fast bin dup

``` 
so after we malloc a chunk 0x100 which is chunk1a what remaining in heap bin is pointo chunk1b which we still has control
so now we create another chunk of 0x70 malloc will find it in unsorted bin and give us the pointer to chunk1b now has size of 0x70 but now we got two index in store which point to the 
same chunk1b
if we free it right after that it go in fast bin but we still control it 
now we can over use the fast bin dup technic to over write the __malloc_hook
```

![image](https://user-images.githubusercontent.com/93699926/227168396-9665c665-740f-4e11-80f2-be05ae08cdb4.png)
```
run it and we get shell
```
![image](https://user-images.githubusercontent.com/93699926/227168580-51cb24d7-8f45-4ccf-bb94-c3e43987cc22.png)


